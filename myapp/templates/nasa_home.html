<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System with Orbits</title>
    <style>

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        #backButton {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 20px;

            background-color: rgba(46, 43, 43, 0.514);
            box-shadow: 0 0px 20px rgba(124, 116, 116, 0.514); /* Blue background */
            color: #fff; /* White text */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 100;
            display: none;
            transition: background-color 0.3s, transform 0.3s; /* Animation on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add shadow for depth */
        }

        #backButton:hover {
            background-color: rgba(255, 255, 255, 0.514); /* Darker blue on hover */
            transform: translateY(-2px); /* Raise button slightly */
            box-shadow: 0 0px 20px rgba(124, 116, 116, 0.514);
        }

        #backButton:before {
            content: '←'; /* Left arrow symbol */
            margin-right: 8px; /* Space between symbol and text */
            font-size: 20px; /* Size of the arrow */
        }

        #infoPanel {
            position: absolute;
            top: 180px;
            left: 30px;
            height: 300px;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.834);
            color: rgb(216, 216, 216);
            padding: 10px;
            border-radius: 5px;
            display: none;
            box-shadow: 0 0px 20px rgba(124, 116, 116, 0.514);
        }
        #modelName {
            text-align: center;
            font-size: 24px; /* Default title size */
            transition: font-size 0.1s; /* Smooth transition */

        }

        #infoPanel:hover #modelName {
            font-size: 25px; /* Increased title size on hover */
            text-shadow: 0 0px 20px rgb(124, 116, 116);
        }

        #distanceInfo {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #fff;
    font-size: 16px;
    z-index: 100;

    text-align: right; /* Align text to the right */
    display: flex; /* Use flexbox for layout */
    display: none;
}

        #modelInfo {
    margin-top: 2px; /* Reduced distance between title and content */
}

#quizButton {
            position: absolute;
            bottom: 10px; /* Positioning at the bottom */
            right: 10px; /* Positioning at the right */
            padding: 10px 20px;
            background-color: rgba(46, 43, 43, 0.514);
            box-shadow: 0 0px 20px rgba(124, 116, 116, 0.514);
            color: #fff; /* White text */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 100;
            transition: background-color 0.3s, transform 0.3s;
            display: none;
        }

        #quizButton:hover {
            background-color: rgba(255, 255, 255, 0.514);
            transform: translateY(-2px);
            box-shadow: 0 0px 20px rgba(124, 116, 116, 0.514);
        }

         body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

    .info-panel {
    width: 25%;
    height: 50%;
    background-color: #282828;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    margin-right: 20px; /* Changed to margin-right */
    position: absolute; /* Change from relative to absolute for better control */
    right: 0; /* Position the panel to the right */
    top: 50%; /* Center it vertically */
    transform: translateY(-50%); /* Adjust for vertical centering */
  }
        .slides {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .slide {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #ffffff;
        }

        .slide.active {
            display: flex;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #444;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #555;
        }

        video {
            width: 100%;
            /* Make video take full width of the panel */
            height: auto;
            border-radius: 10px;
            cursor: pointer;
        }
        /* Fullscreen mode for video */

        .fullscreen-video {
            position: fixed;
    bottom: 0;
            margin-top: 30px;
    right: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
        }

        .fullscreen-video video {
            width: 80vw;  /* Set a width relative to the viewport */
    height: auto;
        }
        /* Button to close fullscreen */

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff4d4d;
            border: none;
            padding: 10px;
            color: white;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            z-index: 11;
        }



    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="info-panel">
    <div class="slides">
        <!-- Slide 1: Video Player -->
        <div class="slide active" id="slide1">
            <video id="infoVideo" controls>
                <source src="{% static 'models/mars.mp4' %}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
    </div>

    <!-- Fullscreen video container -->
    <div id="fullscreenContainer" class="fullscreen-video" style="display: none;">
        <button class="close-btn" id="closeFullscreen">X</button>
        <video id="fullscreenVideo" controls>
            <source src="{% static 'models/mars.mp4' %}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>

<div id="distanceInfo">

    <p id="orbitalPeriod">Time for one solar orbit: 0 days</p>
</div>
<button id="backButton">Back</button>
<div id="infoPanel">

    <h3 id="modelName"></h3>
    <p id="modelInfo"></p>
</div>

<button id="quizButton">Quiz</button>


<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>

<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 50000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas') });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true; // Enable shadows
    camera.position.set(0, 400, 400);  // Increased the z position for better initial view
    camera.lookAt(0, 0, 0);

    // Resize canvas when window is resized
    window.addEventListener('resize', () => {
        const width = window.innerWidth;
        const height = window.innerHeight;
        renderer.setSize(width, height);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    });

    document.getElementById('quizButton').addEventListener('click', () => {
        window.location.href = '/quiz/'; // Redirect to your quiz page
    });

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(0, 50, 50);
    directionalLight.castShadow = true; // Enable shadow for the light
    scene.add(directionalLight);

    const loader = new THREE.GLTFLoader();
    const objLoader = new THREE.OBJLoader(); // OBJ Loader for asteroids

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    let modelControls; // Controls for rotating the model

    const symbols = [];
    const orbits = [];
    const asteroids = []; // Array to store asteroid meshes

    const planetColors = {
        'Sun': 0xffd700,
        'Mercury': 0x701d5d,
        'Venus': 0x826d26,
        'Earth': 0x1289c9,
        'Mars': 0x912e0d,
        'Jupiter': 0xa87165,
        'Saturn': 0xc9ba7b,
        'Uranus': 0x547278,
        'Neptune': 0x303b54,
        'Toutatis':0x6e6e6e,
        'Šteins':0x6e6e6e,
        'Castalia':0x6e6e6e,
        'Eros':0x6e6e6e,
        'Sylvia':0x6e6e6e,
        'Itokawa':0x6e6e6e,
        'Bennu':0x6e6e6e,
        'Shoemaker-Levy 9':0x6e6e6e,
        'Comet Hyakutake':0x6e6e6e,
        'Halley\'s Comet':0x6e6e6e,
        'C/2020 F3':0x6e6e6e,
    };

    const bodyNameToApiId = {
        'Sun': 'sun',
        'Mercury': 'mercury',
        'Venus': 'venus',
        'Earth': 'earth',
        'Mars': 'mars',
        'Jupiter': 'jupiter',
        'Saturn': 'saturn',
        'Uranus': 'uranus',
        'Neptune': 'neptune',
        // Add mappings for asteroids and comets
        'Toutatis': 'toutatis',
        'Šteins': 'steins', // Assuming API ID is 'steins'
        'Castalia': 'castalia',
        'Eros': 'eros',
        'Sylvia': 'sylvia',
        'Itokawa': 'itokawa',
        'Bennu': 'bennu',
        'Shoemaker-Levy 9': 'shoemaker-levy-9',
        'Comet Hyakutake': 'comet-hyakutake',
        "Halley's Comet": 'halley',
        'C/2020 F3': 'c-2020-f3'
    };

    let isRotationStopped = false;  // Flag to stop rotation
    let selectedModel = null;
    let fetchedDataCache = {};

    function addSymbol(name, distance, radius, orbitSpeed, textSize,tilt) {

        const orbitGroup = new THREE.Group();
        const color = planetColors[name];
        const geometry = new THREE.SphereGeometry(radius, 32, 32);
        const material = new THREE.MeshStandardMaterial({ color: color, side: THREE.DoubleSide });
        const symbol = new THREE.Mesh(geometry, material);
        symbol.position.set(distance, 0, 0);
        symbol.castShadow = true; // Enable shadow for symbols
        scene.add(symbol);
        const apiId = bodyNameToApiId[name] || name.toLowerCase();
        symbols.push({ name: name,apiId: apiId, symbol: symbol, distance: distance, angle: 0, orbitSpeed: orbitSpeed, tilt:tilt });

        // Create and add label with specified text size
        const label = createLabel(name, textSize);
        scene.add(label);
        symbols[symbols.length - 1].label = label; // Store label reference
        if (name=="Mercury") {
            addOrbit(distance, color,-10);
        }
        else if (name=="Venus") {
            addOrbit(distance, color,-11);
        }
        else if (name=="Earth") {
            addOrbit(distance, color,-10.5);
        }
        else if (name=="Mars") {
            addOrbit(distance, color,-12);
        }
        else if (name=="Jupiter") {
            addOrbit(distance, color,-10);
        }
        else if (name=="Saturn") {
            addOrbit(distance, color,-9);
        }
        else if (name=="Uranus") {
            addOrbit(distance, color,-13);
        }
        else if (name=="Neptune") {
            addOrbit(distance, color,-15);
        }
        else if (name=="Venus") {
            addOrbit(distance, color,-14);
        }
        else if (name=="Toutatis") {
            addOrbit(distance, color,-10);
        }
        else if (name=="Šteins") {
            addOrbit(distance, color,-15);
        }
        else if (name=="Castalia") {
            addOrbit(distance, color,-12);
        }
        else if (name=="Eros") {
            addOrbit(distance, color,-13);
        }
        else if (name=="Sylvia") {
            addOrbit(distance, color,-14);
        }
        else if (name=="Itokawa") {
            addOrbit(distance, color,-9);
        }
        else if (name=="Bennu") {
            addOrbit(distance, color,-9.5);
        }
        else if (name=="Shoemaker-Levy 9") {
            addOrbit(distance, color,-11.5);
        }
        else if (name=="Comet Hyakutake") {
            addOrbit(distance, color,-14.5);
        }
        else if (name=="Halley\'s Comet") {
            addOrbit(distance, color,-13);
        }
        else{
        addOrbit(distance, color,0);
        }
    }

    function createLabel(text, textSize) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        context.font = `${textSize}px Arial`; // Use specified text size
        context.fillStyle = 'white';
        context.fillText(text, 0, textSize); // Draw the text

        const texture = new THREE.Texture(canvas);
        texture.needsUpdate = true;

        const spriteMaterial = new THREE.SpriteMaterial({ map: texture, depthTest: false });
        const sprite = new THREE.Sprite(spriteMaterial);
        sprite.scale.set(100, 50, 1); // Set the scale of the label
        return sprite;
    }

    function addOrbit(distance, color, angle) {
        const radius = distance;
        const tubularSegments = 1;
        const radiusTube = 1;
        const radialSegments = 1000;

        const orbitGeometry = new THREE.TorusGeometry(radius, radiusTube, tubularSegments, radialSegments, Math.PI * 2);
        const orbitMaterial = new THREE.LineBasicMaterial({
            color: color,
            opacity: 0.5,
            transparent: true
        });

        const orbit = new THREE.LineLoop(orbitGeometry, orbitMaterial);
        orbit.rotation.x = Math.PI / 2;
        orbit.rotation.y = THREE.Math.degToRad(angle);
        orbits.push({ orbit: orbit, originalColor: color, planetName: symbols[symbols.length - 1].name });
        scene.add(orbit);
    }


    let stars = [];
    function addStars(count, region) {
    const starGeometry = new THREE.SphereGeometry(0.8, 8, 8);
    const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });

    let maxDistance;

    if (region === 'inner') {
        maxDistance = 3200; // Jupiter's orbit
    } else if (region === 'outer') {
        maxDistance = 18000; // Neptune's orbit
    }

    for (let i = 0; i < count; i++) {
        const star = new THREE.Mesh(starGeometry, starMaterial);
        const x = Math.random() * maxDistance * 2 - maxDistance;
        const y = Math.random() * maxDistance * 2 - maxDistance;
        const z = Math.random() * maxDistance * 2 - maxDistance;

        const distanceFromCenter = Math.sqrt(x * x + y * y + z * z);

        if (region === 'inner' && distanceFromCenter <= 3200) {
            // Add stars only within Jupiter's orbit
            star.position.set(x, y, z);
            scene.add(star);
            stars.push(star); // Add the star to the stars array
        } else if (region === 'outer' && distanceFromCenter > 3200 && distanceFromCenter <= 18000) {
            // Add stars in the outer region, between Jupiter and Neptune
            star.position.set(x, y, z);
            scene.add(star);
            stars.push(star); // Add the star to the stars array
        }
    }
}

// Add more stars until Jupiter's orbit
addStars(15000, 'inner');

// Add fewer stars from Jupiter to Neptune's orbit
addStars(30000, 'outer');


    // Call addSymbol with desired text sizes
    addSymbol('Sun', 0, 35, 0, 54,0);
    addSymbol('Mercury', 300, 8, 0.002, 20, 7);
    addSymbol('Venus', 500, 8, 0.0015, 20, 3);
    addSymbol('Earth', 800, 8, 0.001, 20,23.5);
    addSymbol('Mars', 1250, 13, 0.0008, 20, 6);
    addSymbol('Jupiter', 3200, 45, 0.0006, 22, 3);
    addSymbol('Saturn', 7000, 80, 0.0004, 22,3.5);
    addSymbol('Uranus', 12000, 105, 0.0002, 22,5);
    addSymbol('Neptune', 18000, 150, 0.0001, 5000,1);



            // Add asteroid symbols
    addSymbol('Toutatis', 2500, 15, 0.001, 18,1);
    addSymbol('Šteins', 2700, 15, 0.001, 18,2);
    addSymbol('Castalia', 3000, 15, 0.001, 18,3);
    addSymbol('Eros', 3500, 15, 0.001, 18,4);
    addSymbol('Sylvia', 4000, 15, 0.001, 18,5);
    addSymbol('Itokawa', 4500, 15, 0.001, 18,6);
    addSymbol('Bennu', 5000, 15, 0.001, 18,0);

        // Add comet symbols
    addSymbol('Shoemaker-Levy 9', 5500, 15, 0.001, 18,3);
    addSymbol('Comet Hyakutake', 6000, 15, 0.001, 18,2);
    addSymbol('Halley\'s Comet', 6500, 15, 0.001, 18,1);
    addSymbol('C/2020 F3', 7000, 15, 0.001, 18,0);

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    window.addEventListener('click', function(event) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(symbols.map(obj => obj.symbol));

        if (intersects.length > 0) {
            const clickedSymbol = intersects[0].object;
            const clickedPlanet = symbols.find(obj => obj.symbol === clickedSymbol);

            document.getElementById('quizButton').addEventListener('click', () => {
                const quizUrl = `/quiz/${obj_name.name}/`;
        window.location.href = quizUrl; // Redirect to your quiz page
    });


            if (clickedPlanet) {
                isRotationStopped = true;  // Stop rotation

                // Disable OrbitControls to prevent further zoom or rotation
                controls.enabled = false;

                // Hide the symbol (planet sphere)
                scene.remove(clickedPlanet.symbol);
                scene.remove(clickedPlanet.label); // Remove the label when clicked

                // Calculate camera zoom based on planet's size
                const cameraOffsetDistance = clickedPlanet.distance + clickedSymbol.geometry.parameters.radius * 10; // Adjust 10 for the desired zoom level

                // Move the camera closer to the planet, dynamically calculate Y-offset based on size
                const newCameraPosition = new THREE.Vector3(
                    clickedSymbol.position.x,
                    clickedSymbol.position.y + clickedSymbol.geometry.parameters.radius * 2, // Adjust Y based on size
                    clickedSymbol.position.z + cameraOffsetDistance
                );
                camera.position.copy(newCameraPosition);
                camera.lookAt(clickedSymbol.position); // Make the camera focus on the clicked planet

                // Load the corresponding 3D model
                switch (clickedPlanet.name) {
                    case 'Sun':
                        loadModel('Sun', '{% static "models/bh.glb" %}', clickedSymbol, 3);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Mercury':
                        loadModel('Mercury', '{% static "models/mercury.glb" %}', clickedSymbol, 0.70);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Venus':
                        loadModel('Venus', '{% static "models/venus.glb" %}', clickedSymbol, 95);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Earth':
                        loadModel('Earth', '{% static "models/prithvi.glb" %}', clickedSymbol, 0.4);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Mars':
                        loadModel('Mars', '{% static "models/mars.glb" %}', clickedSymbol, 215, 3);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Jupiter':
                        loadModel('Jupiter', '{% static "models/jupiter.glb" %}', clickedSymbol, 65);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Saturn':
                        loadModel('Saturn', '{% static "models/saturn.glb" %}', clickedSymbol, 3);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Uranus':
                        loadModel('Uranus', '{% static "models/uranus.glb" %}', clickedSymbol, 10);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Neptune':
                        loadModel('Neptune', '{% static "models/neptune.glb" %}', clickedSymbol, 20);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;


                    case 'Toutatis':
                        loadModel('Toutatis', 'models/toutatis.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Šteins':
                        loadModel('Šteins', 'models/stenis.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Castalia':
                        loadModel('Castalia', 'models/castalia.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Eros':
                        loadModel('Eros', 'models/Eros.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Sylvia':
                        loadModel('Sylvia', 'models/sylvia.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Itokawa':
                        loadModel('Itokawa', 'models/Itokawa.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;
                    case 'Bennu':
                        loadModel('Bennu', 'models/Bennu.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;


                    case 'Shoemaker-Levy 9':
                        loadModel('Shoemaker-Levy 9', 'models/neptune.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;

                    case 'Comet Hyakutake':
                        loadModel('Comet Hyakutake', 'models/neptune.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;

                    case 'Halley\'s Comet':
                        loadModel('Halley\'s Comet', 'models/neptune.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;

                    case 'C/2020 F3':
                        loadModel('C/2020 F3', 'models/neptune.glb', clickedSymbol, 50);
                        fetchBodyData(clickedPlanet.apiId, clickedPlanet.name, clickedSymbol);
                        updateDistanceInfo(0, clickedPlanet.distance, calculateOrbitalPeriod(clickedPlanet.name));
                        break;

                    default:
                        console.error('No model found for planet: ', clickedPlanet.name);
                        break;
                }

                // Show the back button
                document.getElementById('backButton').style.display = 'block';
                document.getElementById('quizButton').style.display = 'block';

                // Reset other planets' visibility and rotation
                symbols.forEach(obj => {
                    if (obj.symbol !== clickedPlanet.symbol) {
                        obj.symbol.visible = true; // Make other symbols visible again
                    }
                });

                // Enable model controls for rotating the model manually
                modelControls = new THREE.OrbitControls(camera, renderer.domElement);
                modelControls.enableZoom = false;
                modelControls.enablePan = false;
                modelControls.target.copy(clickedSymbol.position);
                modelControls.update();
            }
        }
    });


    async function fetchBodyData(apiId, name, symbol) {
        try {

            // Check if data is already cachedsssss
            if (fetchedDataCache[apiId]) {
                updateInfoPanel(fetchedDataCache[apiId]);
                return;
            }
            const response = await fetch(`https://api.le-systeme-solaire.net/rest/bodies/${apiId}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            fetchedDataCache[apiId] = data; // Cache the fetched data
            updateInfoPanel(data);

        } catch (error) {
            console.error('Error fetching data:', error);
            updateInfoPanel(null, `Failed to fetch data for ${name}.`);

        }
    }

    // Function to update the info panel
    function updateInfoPanel(data, errorMsg = '') {
    const modelNameElem = document.getElementById('modelName');
    const modelInfoElem = document.getElementById('modelInfo');

    if (data) {
        modelNameElem.innerText = data.englishName || data.name;

        // Retrieve semi-major axis and eccentricity
        const semimajorAxis = data.semimajorAxis; // in kilometers
        const eccentricity = data.eccentricity;

        // Initialize aphelion and perihelion
        let aphelion = 'N/A';
        let perihelion = 'N/A';

        // Check if semimajorAxis and eccentricity are available
        if (semimajorAxis !== undefined && eccentricity !== undefined && semimajorAxis !== null && eccentricity !== null) {
            aphelion = semimajorAxis * (1 + eccentricity);
            perihelion = semimajorAxis * (1 - eccentricity);

            // Format numbers with commas for readability
            aphelion = aphelion.toLocaleString();
            perihelion = perihelion.toLocaleString();
        }
        // Customize the information to display
        let infoHTML = `
            <strong>Name:</strong> ${data.englishName || data.name}<br>
            <strong>Mass:</strong> ${data.mass ? `${data.mass.massValue} x 10^${data.mass.massExponent} kg` : 'N/A'}<br>
            <strong>Gravity:</strong> ${data.gravity ? `${data.gravity} m/s²` : 'N/A'}<br>
            <strong>Mean Radius:</strong> ${data.meanRadius ? `${data.meanRadius} km` : 'N/A'}<br>
            <strong>Density:</strong> ${data.density ? `${data.density} g/cm³` : 'N/A'}<br>
            <strong>Discovery Date:</strong> ${data.discoveryDate || 'N/A'}<br>
            <strong>Discovered By:</strong> ${data.discoveredBy || 'N/A'}<br>
            <strong>Orbital Period:</strong> ${data.sideralOrbit ? `${data.sideralOrbit} days` : 'N/A'}<br>
            <strong>Average Temperature:</strong> ${data.avgTemp ? `${data.avgTemp} K` : 'N/A'}<br>
            <strong>Aphelion:</strong> ${aphelion} km<br>
            <strong>Perihelion:</strong> ${perihelion} km<br>
            <strong>Type:</strong> ${data.bodyType || 'N/A'}<br>
        `;
        modelInfoElem.innerHTML = infoHTML;
    } else if (errorMsg) {
        modelNameElem.innerText = 'Error';
        modelInfoElem.innerText = errorMsg;
    }

    document.getElementById('infoPanel').style.display = 'block'; // Show the info panel
}

    function updateDistanceInfo(distanceFromEarth, distanceFromSun, orbitalPeriod) {
    const distanceInfoDiv = document.getElementById('distanceInfo');

    // Update text
    document.getElementById('distanceFromEarth').innerText = `Distance from Earth: ${distanceFromEarth} km`;
    document.getElementById('distanceFromSun').innerText = `Distance from Sun: ${distanceFromSun} km`;
    document.getElementById('orbitalPeriod').innerText = `Time for one solar orbit: ${orbitalPeriod} days`;

    // Show distance info
    distanceInfoDiv.style.display = 'block';
}

document.getElementById('backButton').addEventListener('click', () => {
    if (selectedModel) {
        scene.remove(selectedModel); // Remove the currently displayed model
        selectedModel = null;
    }

    // Reset camera position
    camera.position.set(0, 400, 400);
    camera.lookAt(0, 0, 0);
    isRotationStopped = false;  // Allow rotation again

    // Re-enable OrbitControls for the main scene
    controls.enabled = true;

    // Hide the back button
    document.getElementById('backButton').style.display = 'none';
    document.getElementById('quizButton').style.display = 'none';

    // Hide the info panel
    document.getElementById('infoPanel').style.display = 'none';

    // Hide distance info - Add this line
    document.getElementById('distanceInfo').style.display = 'none';

    // Show all symbols again
    symbols.forEach(obj => {
        scene.add(obj.symbol);
        scene.add(obj.label); // Add the label back
    });

    // Dispose of model controls
    if (modelControls) {
        modelControls.dispose();
        modelControls = null;
    }
});


    function animate() {
        requestAnimationFrame(animate);

        if (!isRotationStopped) {
            symbols.forEach(obj => {
                obj.angle += obj.orbitSpeed;// Increment the angle based on orbit speed

                const tiltInRadians = THREE.Math.degToRad(obj.tilt);
                const x = obj.distance * Math.cos(obj.angle);
                const z = obj.distance * Math.sin(obj.angle);

                const rotatedX = x * Math.cos(tiltInRadians) - z * Math.sin(tiltInRadians);
                const rotatedZ = x * Math.sin(tiltInRadians) + z * Math.cos(tiltInRadians);
                const rotatedY = obj.distance * Math.sin(tiltInRadians);


                obj.symbol.position.x = rotatedX;
                obj.symbol.position.y = rotatedY
                obj.symbol.position.z = rotatedZ;
                obj.label.position.set(obj.symbol.position.x, obj.symbol.position.y + 10, obj.symbol.position.z); // Adjust label position

            });
        }

        const cameraDistance = camera.position.length(); // Distance from (0, 0, 0)
    const starScale = Math.max(0.1, Math.min(2, cameraDistance / 1000)); // Scale between 0.1 and 2 based on distance

    // Update star sizes
    stars.forEach(star => {
        star.scale.set(starScale, starScale, starScale); // Uniform scaling
    });

    symbols.forEach(obj => {
    obj.angle += obj.orbitSpeed;  // Increment the angle based on the orbit speed

    // Calculate the orbit position on a flat plane (no tilt applied yet)
    const x = obj.distance * Math.cos(obj.angle);
    const z = obj.distance * Math.sin(obj.angle);
    const y = 0;  // Orbit is flat in the X-Z plane, no y-offset.

    // Create a 3D vector for the orbit position (flat plane)
    const position = new THREE.Vector3(x, y, z);

    // Apply the tilt to the entire orbit path using Quaternion
    const tiltInRadians = THREE.Math.degToRad(obj.tilt);  // Convert tilt to radians
    const quaternion = new THREE.Quaternion();
    quaternion.setFromAxisAngle(new THREE.Vector3(1, 0, 0), tiltInRadians);  // Rotate around X-axis for tilt
    position.applyQuaternion(quaternion);  // Apply the rotation to the position vector

    // Set the object's symbol position based on the rotated position vector
    obj.symbol.position.set(position.x, position.y, position.z);

    // Ensure the symbol remains upright, so it doesn’t rotate with the orbit
    obj.symbol.rotation.set(0, 0, 0);  // Keep the symbol facing upwards

    // Adjust the label's position, slightly above the object (y+10 for example)
    obj.label.position.set(position.x, position.y + 10, position.z);
});



        controls.update();
        renderer.render(scene, camera);
    }

    animate();

    // Load model function
    function loadModel(name, url, symbol, scale) {
        loader.load(url, function (gltf) {
            if (selectedModel) {
                scene.remove(selectedModel); // Remove previous model
            }
            selectedModel = gltf.scene;
            selectedModel.scale.set(scale, scale, scale);
            selectedModel.position.copy(symbol.position);
            scene.add(selectedModel);
        }, undefined, function (error) {
            console.error('An error happened while loading the model: ', error);
        });
    }

function calculateOrbitalPeriod(planetName) {
    const orbitalPeriods = {
        'Mercury': 88,
        'Venus': 225,
        'Earth': 365,
        'Mars': 687,
        'Jupiter': 4333,
        'Saturn': 10759,
        'Uranus': 30687,
        'Neptune': 60190,
        'Toutatis': 4.3,
            'Šteins': 2.3,
            'Castalia': 1.6,
            'Eros': 1.75,
            'Sylvia': 3.5,
            'Itokawa': 1.9,
            'Bennu': 1.2,
            'Shoemaker-Levy 9': 2.4,
            'Comet Hyakutake': 3.5,
            'Halley\'s Comet': 76,
            'C/2020 F3': 6.6
    };
    return orbitalPeriods[planetName] || 0; // Default to 0 if planet not found
}


    const slides = document.querySelectorAll('.slide');
let currentSlide = 0;

// Function to show the current slide
function showSlide(index) {
    slides.forEach((slide, i) => {
        slide.classList.remove('active');
        if (i === index) {
            slide.classList.add('active');
        }
    });
}

// Initialize the first slide to be visible
showSlide(currentSlide);

// Video play in fullscreen functionality
const infoVideo = document.getElementById('infoVideo');
const fullscreenContainer = document.getElementById('fullscreenContainer');
const fullscreenVideo = document.getElementById('fullscreenVideo');
const closeFullscreen = document.getElementById('closeFullscreen');

infoVideo.addEventListener('play', () => {
    fullscreenVideo.currentTime = infoVideo.currentTime; // Sync time
    infoVideo.pause(); // Pause the video in the info panel
    fullscreenContainer.style.display = 'flex'; // Show fullscreen container
    fullscreenVideo.play(); // Play the video in fullscreen mode
});

// Close fullscreen and stop the video
closeFullscreen.addEventListener('click', () => {
    fullscreenVideo.pause(); // Pause the video in fullscreen
    fullscreenContainer.style.display = 'none'; // Hide fullscreen container
});

// Sync fullscreen video time when closing fullscreen
fullscreenVideo.addEventListener('pause', () => {
    infoVideo.currentTime = fullscreenVideo.currentTime; // Sync time when closing
});

document.getElementById('infoVideo').addEventListener('click', function() {
    document.getElementById('fullscreenContainer').style.display = 'flex';
    var fullscreenVideo = document.getElementById('fullscreenVideo');
    fullscreenVideo.play(); // Start playing the video when opened
    if (fullscreenVideo.requestFullscreen) {
        fullscreenVideo.requestFullscreen();
    } else if (fullscreenVideo.mozRequestFullScreen) { // Firefox
        fullscreenVideo.mozRequestFullScreen();
    } else if (fullscreenVideo.webkitRequestFullscreen) { // Chrome, Safari, and Opera
        fullscreenVideo.webkitRequestFullscreen();
    } else if (fullscreenVideo.msRequestFullscreen) { // IE/Edge
        fullscreenVideo.msRequestFullscreen();
    }
});

// Close fullscreen
document.getElementById('closeFullscreen').addEventListener('click', function() {
    document.getElementById('fullscreenContainer').style.display = 'none';
    var fullscreenVideo = document.getElementById('fullscreenVideo');
    fullscreenVideo.pause(); // Pause video when closing fullscreen
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.mozCancelFullScreen) { // Firefox
        document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) { // Chrome, Safari, and Opera
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) { // IE/Edge
        document.msExitFullscreen();
    }
});


</script>


</body>
</html>
